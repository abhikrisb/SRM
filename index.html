<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SRM University Ramapuram</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="image/logo.png" alt="SRM Logo" class="logo">
        </div>
        <h1>SRM University Ramapuram</h1>
    </header>
    <main>
        <div class="serviceBox">
            <button class="tab1">ID Card</button>
            <button class="tab2">Face Check</button>
        </div>

        <div id="idcard" class="tabcontent">
            <video id="video1" controls autoplay playsinline></video>
            <canvas id="canvas1" hidden width="500" height="300"></canvas>
            <select id="cameraSelect1"></select>
            <button id="button1">Capture ID Card</button>
            <button id="reset1">Reset</button>
            <button id="button3">Continue</button>
        </div>
        
        <div id="face" class="tabcontent1">
            <video id="video2" controls autoplay playsinline></video>
            <canvas id="canvas2" hidden width="500" height="300"></canvas>
            <select id="cameraSelect2"></select>
            <button id="button2">Capture Face</button>
            <button id="reset2">Reset</button>
            <button id="button4">Submit</button>
        </div>
    </main>
    <footer>
        <!-- <p>&copy; 2024 SRM University Ramapuram. All Rights Reserved.</p> -->
        <p>Made with a whole lot of caffeine.</p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
    <script async src="https://docs.opencv.org/4.x/opencv.js" type="text/javascript"></script>
    <script type="module">
        import pixelmatch from 'https://esm.run/pixelmatch';
    
        document.getElementById('camera_button1').addEventListener('click', async function () {
            const canvas1 = document.getElementById('canvas1');
            const video1 = document.getElementById('video1');
            const ctx = canvas1.getContext('2d');
            ctx.drawImage(video1, 0, 0, canvas1.width, canvas1.height);
    
            video1.style.display = "none";
            camera_button1.style.display = "none";
            document.getElementById('cameraSelect1').style.display = "none";
            canvas1.style.display = "block";
    
            // Capture the image data
            const image1 = canvas1.toDataURL('image/jpeg');
            navigator.clipboard.writeText(image1)
                .then(() => console.log('Image data URL copied to clipboard!'))
                .catch(err => console.error('Failed to copy image data URL: ', err));
    
            // Check for face in the image
            await checkFace(image1);  
            captureCount++;
            if (captureCount >= 1) {
                document.getElementById('resetButton').style.display = "block"; // Show the reset button below the canvas
                document.getElementById('button3').style.display = "block"; // Show the continue button below the canvas
            }
    
            // Load reference image
            const referenceImage = document.getElementById('referenceImage');
    
            // Convert captured image to Image object
            const capturedImage = new Image();
            capturedImage.src = image1;
            await new Promise(resolve => capturedImage.onload = resolve);
    
            // Create canvases for images
            const referenceCanvas = document.createElement('canvas');
            referenceCanvas.width = referenceImage.width;
            referenceCanvas.height = referenceImage.height;
            const referenceCtx = referenceCanvas.getContext('2d');
            referenceCtx.drawImage(referenceImage, 0, 0);
    
            const capturedCanvas = document.createElement('canvas');
            capturedCanvas.width = capturedImage.width;
            capturedCanvas.height = capturedImage.height;
            const capturedCtx = capturedCanvas.getContext('2d');
            capturedCtx.drawImage(capturedImage, 0, 0);
    
            // Compare images using pixelmatch
            const diffCanvas = document.createElement('canvas');
            diffCanvas.width = referenceImage.width;
            diffCanvas.height = referenceImage.height;
            const diffCtx = diffCanvas.getContext('2d');
            const diff = diffCtx.createImageData(referenceImage.width, referenceImage.height);
    
            const numDiffPixels = pixelmatch(
                referenceCtx.getImageData(0, 0, referenceImage.width, referenceImage.height).data,
                capturedCtx.getImageData(0, 0, capturedImage.width, capturedImage.height).data,
                diff.data,
                referenceImage.width,
                referenceImage.height,
                { threshold: 0.1 }
            );
    
            console.log(`Number of different pixels: ${numDiffPixels}`);
        });
    </script>
    <script defer type = "module" src="script.js"></script>
</body>
</html>
